```markdown
# ITKAchievementBot

ITKAchievementBot – это Telegram-бот, который превращает общение в настоящее приключение! Проект сочетает элементы геймификации и RPG с IT-тематикой, автоматически выдавая достижения пользователям за их активность в чате.

---

## Содержание

- [Описание](#описание)
- [Ключевые возможности](#ключевые-возможности)
- [Архитектура проекта](#архитектура-проекта)
- [Используемые технологии](#используемые-технологии)
- [Как это работает](#как-это-работает)
- [Тестирование](#тестирование)
- [Вклад и развитие](#вклад-и-развитие)
- [Лицензия](#лицензия)

---

## Описание

ITKAchievementBot анализирует активность пользователей (сообщения, медиафайлы, стикеры, реакции) и автоматически выдаёт достижения в соответствии с заданными условиями. Достижения могут начисляться за количественные показатели (например, общее число сообщений) или за особые действия (например, использование определённых ключевых слов с периодом "охлаждения"). Дополнительно реализована функция еженедельного награждения самого активного пользователя.

---

## Ключевые возможности

- **Автоматическая выдача достижений**
  - **Сообщения:** Награды за достижение определённого количества сообщений.
  - **Ключевые слова:** Выдача ачивок при использовании специальных слов (с периодом "охлаждения").
  - **Реакции, Медиа и Стикеры:** Достижения за получение реакций, отправку медиафайлов или стикеров.
  - **Кастомные достижения:** Возможность вручную выдавать достижения с произвольными параметрами через админ-панель.
  
- **Еженедельное награждение**
  - Планировщик автоматически определяет самого активного пользователя недели и выдаёт ему специальное достижение, после чего еженедельный счётчик сбрасывается.
  
- **Асинхронная обработка**
  - Долгие операции (например, генерация изображений и отправка уведомлений) выполняются в отдельных потоках, что повышает отзывчивость бота.
  
- **Кэширование**
  - Определения достижений кэшируются для снижения нагрузки на базу данных.
  
- **Гибкая конфигурация**
  - Параметры изображений (шаблон, цвета, шрифты, позиционирование текста) настраиваются через внешний файл конфигурации.

---

## Архитектура проекта

Проект построен с использованием многоуровневой архитектуры:

- **Bot Layer**
  - **ITKAchievementBot:** Основной класс, который получает обновления от Telegram и распределяет их между сервисами.
  - **AdminCommandHandler:** Обрабатывает административные команды для выдачи кастомных достижений.

- **Service Layer**
  - **AchievementService:** Отвечает за проверку условий и выдачу достижений.
  - **UserActivityService:** Обновляет статистику активности пользователей (общие и еженедельные счётчики).
  - **AchievementDefinitionService:** Предоставляет кэшированные данные об определениях достижений.
  - **AchievementNotificationService:** Асинхронно отправляет уведомления о достижениях.
  - **Стратегии выдачи достижений:** Различные реализации (например, MessageCount, Keyword, Reaction, Media, Sticker) определяют условия для получения достижения.

- **Scheduler**
  - **WeeklyActivityScheduler:** Каждую неделю определяет самого активного пользователя и выдаёт ему специальное достижение, затем сбрасывает еженедельные счётчики.

- **Data Layer**
  - Используется Spring Data JPA с H2-базой данных для хранения пользователей, достижений и их определений.

- **Configuration**
  - Классы для настройки кэширования, асинхронного выполнения, планировщика и параметров бота позволяют гибко управлять приложением через `application.properties`.

---

## Используемые технологии

- **Язык:** Java 17
- **Фреймворк:** Spring Boot
- **База данных:** H2 (можно заменить на другую СУБД)
- **ORM:** Spring Data JPA
- **Асинхронность и планирование:** Spring Async, Spring Scheduling
- **Кэширование:** Spring Cache (ConcurrentMapCacheManager)
- **Работа с изображениями:** ImageIO (с поддержкой TwelveMonkeys для JPEG)
- **Telegram API:** [telegrambots](https://github.com/rubenlagus/TelegramBots)

---

## Как это работает

1. **Обработка обновлений:**  
   При получении обновления бот анализирует сообщение и обновляет статистику пользователя (общий и еженедельный счётчики).

2. **Проверка достижений:**  
   На основе заранее заданных определений (achievement definitions) бот проверяет, выполнены ли условия для выдачи достижения с помощью различных стратегий.

3. **Выдача достижения:**  
   Если условие выполнено, генерируется изображение достижения, и пользователь получает уведомление в Telegram. Выдача происходит асинхронно для повышения производительности.

4. **Еженедельное награждение:**  
   Планировщик каждую неделю выбирает пользователя с наибольшей активностью и выдаёт ему специальное достижение, после чего еженедельные счётчики сбрасываются.

5. **Кэширование:**  
   Определения достижений кэшируются для минимизации нагрузки на базу данных.

---

## Тестирование

Проект включает юнит-тесты для проверки основных компонентов:
- **UserActivityServiceTest:** Проверяет корректное обновление статистики пользователя.
- **AchievementImageGeneratorTest:** Проверяет генерацию изображений достижений.

---

## Вклад и развитие

ITKAchievementBot создан как демонстрация возможностей геймификации в IT-сфере. Если у вас есть предложения, идеи или улучшения, пожалуйста, создайте Issue или Pull Request на GitHub.

---

## Лицензия

Этот проект распространяется под лицензией MIT.
```